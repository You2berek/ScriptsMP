local kill = false

task.spawn(function()
    while true do
        if _G.killAllNCD then
            kill = true
            break
        end
        task.wait(1)
    end
end)

game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessedEvent)
    if gameProcessedEvent or kill then return end

    local plrs = game:GetService("Players")
    local plr = plrs.LocalPlayer
    local char = plr.Character
    if not char or not char:FindFirstChild("Humanoid") or not char:FindFirstChild("Patrick") then return end

    local Humanoid = char.Humanoid
    local Animator = Humanoid:FindFirstChild("Animator")
    local scriptVar = char.Patrick
    local Anims = scriptVar:FindFirstChild("Animations")
    local Repl = game:GetService("ReplicatedStorage")
    local Chars = Repl:FindFirstChild("Characters")
    if not Chars then return end

    local Rems = Chars.Patrick:FindFirstChild("Remotes")
    if not Rems then return end

    local CombatHitbox = Chars.Combat.Fx.CombatHitbox
    local HitboxPunch = Chars.Combat.Peacemaker.HitboxPunch
    local Mouse = plr:GetMouse()

    local function Dash(arg1)
        local BodyPosition = Instance.new("BodyPosition")
        BodyPosition.MaxForce = Vector3.new(1e6, 1e6, 1e6)
        BodyPosition.P = 50000
        BodyPosition.D = 3000
        BodyPosition.Position = (arg1.CFrame * CFrame.new(0, 0, -10)).Position
        BodyPosition.Parent = arg1
        game.Debris:AddItem(BodyPosition, 0.7)
    end

    local Move2 = Animator:LoadAnimation(Anims.MoveTwo)
    local Move4 = Animator:LoadAnimation(Anims.MoveFourStart)
    local gunAnim = char:FindFirstChild("GunAnim")
    if not gunAnim then
        gunAnim = Instance.new("Animation")
        gunAnim.Parent = char
        gunAnim.Name = "GunAnim"
        gunAnim.AnimationId = "rbxassetid://11457473894"
    end
    local GunShot = Animator:LoadAnimation(gunAnim)

    if input.KeyCode == Enum.KeyCode.One then
        scriptVar.DestroyCounter:FireServer()
        Rems.MoveOne:FireServer()
    elseif input.KeyCode == Enum.KeyCode.Two then
        Move2:Play()
        Rems.MoveTwo:FireServer()
    elseif input.KeyCode == Enum.KeyCode.Three then
        scriptVar.DestroyCounter:FireServer()
        Rems.MoveThree:FireServer()
    elseif input.KeyCode == Enum.KeyCode.Four then
        Move4:Play()
        scriptVar.ChainsawOn:FireServer()
        task.wait(Move4.Length)
        local bv = Instance.new("BodyVelocity")
        bv.Parent = char.HumanoidRootPart
        bv.P = 8000
        bv.MaxForce = Vector3.new(50000, 0, 50000)
        bv.Velocity = char.HumanoidRootPart.CFrame.LookVector * 49
        game.Debris:AddItem(bv, 1.5)
        Rems.MoveFour:FireServer()
        local runDuration = 1.5
        local startTime = tick()
        while tick() - startTime < runDuration do
            if bv then
                wait(0.1)
                bv.Velocity = char.HumanoidRootPart.CFrame.LookVector * 49
            end
        end
    elseif input.KeyCode == Enum.KeyCode.Five then
        scriptVar.DestroyCounter:FireServer()
        Rems.Finisher:FireServer()
    elseif input.KeyCode == Enum.KeyCode.E then
        scriptVar.Headphones:FireServer()
        scriptVar.DestroyCounter:FireServer()
    elseif input.KeyCode == Enum.KeyCode.T then
        GunShot:Play()
        task.wait(.2)
        scriptVar.Gun:FireServer()
        Chars.Walter.Remotes.GunCounter:FireServer()
        local hb = CombatHitbox:Clone()
        hb.Parent = char
        local wd = Instance.new("Weld", hb)
        wd.Part0 = hb
        wd.Part1 = char.HumanoidRootPart
        wd.C0 = CFrame.new(0, 0, 3.5)
        game.Debris:AddItem(hb, .2)
        local hitConn
        hitConn = hb.Touched:Connect(function(p)
            local P1 = p.Parent
            local hd = P1 and P1:FindFirstChild("Humanoid")
            if hd and hd.Health ~= 0 then
                scriptVar.DestroyCounter:FireServer()
                hb:Destroy()
                Chars.Walter.Remotes.GunCounterHit:FireServer(P1)
                if hitConn then hitConn:Disconnect() end
            end
        end)
    end
end)
