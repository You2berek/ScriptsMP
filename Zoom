
local plrs = game:GetService("Players")
local plr = plrs.LocalPlayer
local char = plr.Character
local Humanoid = char:FindFirstChild("Humanoid")
local Animator = Humanoid:FindFirstChild("Animator")

if not char:FindFirstChild("Zoom") then return end
local scriptVar = char:FindFirstChild("Zoom")
local Anims = scriptVar:FindFirstChild("Animations")
local Repl = game:GetService("ReplicatedStorage")
local Chars = Repl:FindFirstChild("Characters")
local Rems = Chars:FindFirstChild("Zoom"):WaitForChild("Remotes")
local CombatHitbox = Chars.Combat.Fx.CombatHitbox
local HitboxPunch = Chars.Combat.Peacemaker.HitboxPunch
local TweenService = game:GetService("TweenService")
local Mouse = plr:GetMouse()

-- Animations
local PunchesAnim = Animator:LoadAnimation(Anims.BarragePunches)
local PunchesAnimBuff = Animator:LoadAnimation(Anims.BarragePunches)
local Grab = Animator:LoadAnimation(Anims.Grab)
local TornadoRun = Animator:LoadAnimation(Anims.TornadoRun)
local StartRunA = Animator:LoadAnimation(Anims.StartRun)
local RunA =  Animator:LoadAnimation(Anims.SuperSpeed)
local RunAExe =  Animator:LoadAnimation(Anims.SuperSpeedExe)

local function FinalRush()
if _G.FinalRushBlock == true then return end
game.ReplicatedStorage.Characters.TheFlashCw.Remotes.Final:FireServer()
_G.FinalRushBlock = true
task.spawn(function()
	task.wait(12)
    _G.FinalRushBlock = false
end)
end


-- Punch connection
local function SetupPunchConnections()
	PunchesAnim:GetMarkerReachedSignal("Start"):Connect(function()
		scriptVar.Move1:FireServer()
	end)
	PunchesAnim:GetMarkerReachedSignal("Punch"):Connect(function()
		local hb = CombatHitbox:Clone()
		hb.Parent = char
		local wd = Instance.new("Weld", hb)
		wd.Part0 = char.HumanoidRootPart
		wd.Part1 = hb
		game.Debris:AddItem(hb, .2)
		hb.Touched:Connect(function(p)
			local P1 = p.Parent
			local hmn = P1:FindFirstChild("Humanoid")
			if hmn and hmn.Health ~= 0 then
				hb:Destroy()
				scriptVar.Move1Hit:FireServer()
				for i=1,3 do
					Chars.Combat.Remotes.Combo:FireServer(P1)
				end
			end
		end)
	end)

	PunchesAnimBuff:GetMarkerReachedSignal("Start"):Connect(function()
		scriptVar.Move1:FireServer()
	end)
	PunchesAnimBuff:GetMarkerReachedSignal("Punch"):Connect(function()
		local hb = CombatHitbox:Clone()
		hb.Parent = char
		local wd = Instance.new("Weld", hb)
		wd.Part0 = char.HumanoidRootPart
		wd.Part1 = hb
		game.Debris:AddItem(hb, .2)
		hb.Touched:Connect(function(p)
			local P1 = p.Parent
			local hmn = P1:FindFirstChild("Humanoid")
			if hmn and hmn.Health ~= 0 then
				hb:Destroy()
				scriptVar.Move1Hit:FireServer()
				for i=1,5 do
					Chars.DarthVader.Remotes.Bash2:FireServer(P1)
					Chars.Combat.Remotes.Combo:FireServer(P1)
				end
			end
		end)
	end)
end

-- Functions (pulled out)
local function Move1(buff)
	if buff then
		PunchesAnimBuff:Play()
	else
		PunchesAnim:Play()
	end
end

local function Rush()
	Chars.TheFlashCw.Remotes.Rush:FireServer(Mouse.Hit.Position)
end

local function Move4()
	Rems.Choke:FireServer()
	Grab:Play()
end

local function Velocity9()
	for i=1,10 do
		Rems.V9:FireServer()
	end
end

local function Counter()
	scriptVar.DestroyCounter:FireServer()
	Rems.Counter:FireServer()
	task.spawn(function()
		task.wait(.5)
		scriptVar.DestroyCounter:FireServer()
		task.wait(.5)
		scriptVar.DestroyCounter:FireServer()
	end)
end

local function Tornado()
	TornadoRun:Play()
	Chars.TheFlashCw.Remotes.Mirrage:FireServer()
end

local function RunBuff()
	StartRunA:Play()
Chars.TheFlashCw.Remotes.FastestMan1:FireServer(plr)
wait(1)
Chars.TheFlashCw.Remotes.FastestMan:FireServer(plr)
if not char:FindFirstChild("Exe") then
RunA:Play()
else
RunAExe:Play()
end
local BodyVel = Instance.new("BodyVelocity")
BodyVel.Parent = char.HumanoidRootPart
BodyVel.P = 5500
BodyVel.MaxForce = Vector3.new(1000000, 0, 1000000)
BodyVel.Velocity = char.HumanoidRootPart.CFrame.lookVector * 235
game.Debris:AddItem(BodyVel, 3)
local Hitbox = CombatHitbox:Clone()
Hitbox.Parent = char
local Weld = Instance.new("Weld", Hitbox)
Weld.Part0 = Hitbox
Weld.Part1 = char.HumanoidRootPart
Weld.C0 = CFrame.new(0, 0, 3.5) * CFrame.Angles(0, 0, 0)
game.Debris:AddItem(Hitbox, 3)
Hitbox.Touched:Connect(function(Dark)
local Parent1 = Dark.Parent
local Humanoid = Parent1:FindFirstChild("Humanoid")
if Humanoid and Humanoid.Health ~= 0 and not Parent1:FindFirstChild("SuperSpeedDmgVal") then
   if Parent1 ~= char then
      local Val = Chars.Values.SuperSpeedDmgVal:Clone()
      Val.Parent = Parent1
      game.Debris:AddItem(Val, .3)
      for i=1,55 do
      Chars.Combat.Remotes.ComboEndRemote:FireServer(Parent1)   
      end
      end
end
end)

local runDuration = 3
local startTime = tick()

while tick() - startTime < runDuration do
    if BodyVel then
        wait(0.1)
        BodyVel.Velocity = char.HumanoidRootPart.CFrame.LookVector * 235
    end
end
end

local function Run()
StartRunA:Play()
Chars.TheFlashCw.Remotes.FastestMan1:FireServer(plr)
wait(1)
Chars.TheFlashCw.Remotes.FastestMan:FireServer(plr)
if not char:FindFirstChild("Exe") then
RunA:Play()
else
RunAExe:Play()
end
local BodyVel = Instance.new("BodyVelocity")
BodyVel.Parent = char.HumanoidRootPart
BodyVel.P = 5500
BodyVel.MaxForce = Vector3.new(1000000, 0, 1000000)
BodyVel.Velocity = char.HumanoidRootPart.CFrame.lookVector * 100
game.Debris:AddItem(BodyVel, 3)
local Hitbox = CombatHitbox:Clone()
Hitbox.Parent = char
local Weld = Instance.new("Weld", Hitbox)
Weld.Part0 = Hitbox
Weld.Part1 = char.HumanoidRootPart
Weld.C0 = CFrame.new(0, 0, 3.5) * CFrame.Angles(0, 0, 0)
game.Debris:AddItem(Hitbox, 3)
Hitbox.Touched:Connect(function(Dark)
local Parent1 = Dark.Parent
local Humanoid = Parent1:FindFirstChild("Humanoid")
if Humanoid and Humanoid.Health ~= 0 and not Parent1:FindFirstChild("SuperSpeedDmgVal") then
   if Parent1 ~= char then
      local Val = Chars.Values.SuperSpeedDmgVal:Clone()
      Val.Parent = Parent1
      game.Debris:AddItem(Val, .3)
      for i=1,2 do
      Chars.Combat.Remotes.ComboEndRemote:FireServer(Parent1)   
      end
      end
end
end)

local runDuration = 3
local startTime = tick()

while tick() - startTime < runDuration do
    if BodyVel then
        wait(0.1)
        BodyVel.Velocity = char.HumanoidRootPart.CFrame.LookVector * 100
    end
end
end

-- Setup animations once
SetupPunchConnections()

-- Input
game:GetService("UserInputService").InputBegan:Connect(function(input, gp)
	if gp then return end

	if input.KeyCode == Enum.KeyCode.One then
		Move1(false)
	elseif input.KeyCode == Enum.KeyCode.Two then
		Run()
	elseif input.KeyCode == Enum.KeyCode.Three then
		Counter()
	elseif input.KeyCode == Enum.KeyCode.Four then
		Move4()
	elseif input.KeyCode == Enum.KeyCode.Five then
		if not char:FindFirstChild("Exe") then
			Rems.Finisher:FireServer()
		else
			Chars.TheFlashCw.Remotes.ReverseFinisher:FireServer()
		end
	elseif input.KeyCode == Enum.KeyCode.E then
		Velocity9()
	elseif input.KeyCode == Enum.KeyCode.R then
		Move1(true)
	elseif input.KeyCode == Enum.KeyCode.T then
		Rush()
	elseif input.KeyCode == Enum.KeyCode.G then
		RunBuff()
	elseif input.KeyCode == Enum.KeyCode.H then
		Tornado()
    elseif input.KeyCode == Enum.KeyCOde.J then
        FinalRush()
	end
end)

